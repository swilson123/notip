var radio_commands = function (rover, message) {

	//console.log("rc: ",message);
	//throttle command.....................
	rover.rc_contoller.connected = true;

	if (message.chan9_raw > 1500 && rover.rplidar.avoid_object) {
		console.log("LIDAR Obstacle Avoidance Disabled");
		rover.rplidar.avoid_object = false;
		rover.mission.path_clear = true;
	}
	else if (message.chan9_raw <= 1500 && !rover.rplidar.avoid_object) {
		console.log("LIDAR Obstacle Avoidance Enabled");
		rover.rplidar.avoid_object = true;
	}

	if (message.chan11_raw < 1500 && !rover.robot_data.mission_mode) {
		rover.robot_data.mission_mode = true;

		rover.mission.mission_interval = setInterval(() => {
			rover.run_mission(rover);
		}, 250);


	}
	else if (message.chan11_raw >= 1500) {
		
		if (rover.robot_data.mission_mode) {
			rover.robot_data.mission_mode = false;
			clearInterval(rover.mission.mission_interval);
			+		console.log("Mission mode disabled by RC");
			//stop the rover	
			rover.move_rover(rover, 1, 0);
			rover.move_rover(rover, 2, 0);
			rover.move_rover(rover, 3, 0);
			rover.move_rover(rover, 4, 0);

			//turn wheels straight
			rover.servo_send_command(rover, 11, 1500);
			rover.servo_send_command(rover, 12, 1500);
			rover.servo_send_command(rover, 13, 1500);
			rover.servo_send_command(rover, 14, 1500);
		}
	}

	if (!rover.robot_data.mission_mode) {
		var throttle = message.chan3_raw;
		var yaw = message.chan1_raw;
		var motor_speed_cmd = 0;

		if (!rover.rc_contoller.pause_cmd) {

			rover.rc_contoller.pause_cmd = true;

			if (throttle > 1900) {
				motor_speed_cmd = 200;

			} else if (throttle > 1850) {
				motor_speed_cmd = 175;
			}
			else if (throttle > 1800) {
				motor_speed_cmd = 150;
			}
			else if (throttle > 1750) {
				motor_speed_cmd = 125;
			}
			else if (throttle > 1700) {
				motor_speed_cmd = 100;
			}
			else if (throttle > 1650) {
				motor_speed_cmd = 75;
			}
			else if (throttle > 1600) {
				motor_speed_cmd = 50;
			}
			else if (throttle > 1550) {
				motor_speed_cmd = 25;
			}
			else if (throttle > 1450) {
				motor_speed_cmd = 0;
			}
			else if (throttle > 1400) {
				motor_speed_cmd = -25;
			}
			else if (throttle > 1350) {
				motor_speed_cmd = -50;
			}
			else if (throttle > 1300) {
				motor_speed_cmd = -75;
			}
			else if (throttle > 1250) {
				motor_speed_cmd = -100;
			}
			else if (throttle > 1200) {
				motor_speed_cmd = -125;
			}
			else if (throttle > 1150) {
				motor_speed_cmd = -150;
			}
			else if (throttle > 1100) {
				motor_speed_cmd = -175;
			}
			else {
				motor_speed_cmd = -200;
			}

			setTimeout(() => {
				//front passenger
				if (message.chan1_raw > 1450 && message.chan1_raw < 1550 || message.chan1_raw > 1900 || message.chan1_raw < 1100) {
					rover.move_rover(rover, 1, motor_speed_cmd * -1);

				} else {
					rover.move_rover(rover, 1, motor_speed_cmd);
				}

			}, 10);

			setTimeout(() => {
				rover.move_rover(rover, 2, motor_speed_cmd);
			}, 20);
			setTimeout(() => {
				//front driver side
				if (message.chan1_raw > 1900 || message.chan1_raw < 1100) {
					rover.move_rover(rover, 3, motor_speed_cmd * -1);
				} else {
					rover.move_rover(rover, 3, motor_speed_cmd);
				}

			}, 30);
			setTimeout(() => {
				//rear driver side
				if (message.chan1_raw > 1450 && message.chan1_raw < 1550) {
					rover.move_rover(rover, 4, motor_speed_cmd * -1);
				} else {
					rover.move_rover(rover, 4, motor_speed_cmd);
				}

				rover.rc_contoller.pause_cmd = false;
			}, 40);

		}

	}

};


module.exports = radio_commands;